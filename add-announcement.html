<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Add announcement | Antise</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="sass/styles.css">

    <script type="module" src="js/announcementsHandler.js"></script>
</head>
<body>
<div class="header">
    <div class="heading">Antise</div>
</div>

<div class="navbar">
    <a href="logged.html">Main page</a>
    <a href="user-page.html">
        <div class="profile-container">
            <span>Welcome, taras134</span>
            <img src="img/car.jpg" alt="Profile photo">
        </div>
    </a>
</div>

<div class="caption">Add an announcement</div>

<div class="container">
    <div class="announcement-creation-container">
            <form id="" class="login-reg-form">
                <label for="titleInput">Title</label>
                <input class="red-input" type="text" id="titleInput" required minlength="3" maxlength="24"
                value="Title">

                <label for="descriptionInput">Description</label>
                <input class="red-input" type="text" id="descriptionInput" required minlength="3" maxlength="255"
                value="Description">

                <label for="datetime">Date</label>
                <input id="datetime" type="datetime-local">

                <label for="locationInput">Location</label>
                <input class="red-input" type="text" id="locationInput" required maxlength="45" value="1">

                <div class="radio-title">Type</div>
                <div class="signup-form-radio">
                    <label for="publicChoice">Public</label>
                    <input type="radio" id="publicChoice" name="announcementTypeChoice" value="1" checked>

                    <label for="localChoice">Local</label>
                    <input type="radio" id="localChoice" name="announcementTypeChoice" value="2">
                </div>

                <label class="file-upload">
                    <input type="file"/>
                    Upload an image
                </label>

                <div class="submit-button-container">
                    <button class="submit-form-button" type="submit" onclick="addAnnouncement()">Submit</button>
                </div>
            </form>
    </div>
</div>

<footer class="footer">
    <div class="footer-right-social">
        <a href="https://www.facebook.com/"><img src="img/footer/facebook.svg" alt=""></a>
        <a href="https://www.instagram.com/"><img src="img/footer/instagram.svg" alt=""></a>
    </div>
    <div class="footer-left">
        <div class="footer-links">
            <a class="link-1" href="#">About</a>
            <a href="#">Contact us</a>
        </div>
        <div class="copyright">Antise &copy; 2021</div>
    </div>
</footer>
</body>

<script>
    function addAnnouncement() {
        const reqURL = `http://127.0.0.1:5000/announcements`;

        console.log('here');

        const title = encodeURIComponent(document.getElementById('titleInput').value);
        const description = encodeURIComponent(document.getElementById('descriptionInput').value);
        const pubDate = Date.now();
        const radios = document.getElementsByName('announcementTypeChoice');

        const radiosLength = radios.length;
        let announcementType = null;
        for (let i = 0; i < radiosLength; i += 1) {
            if (radios[i].checked) {
                announcementType = radios[i].value;
                break;
            }
        }

        const authorId = JSON.parse(localStorage.getItem('userData')).id;

        const request = new XMLHttpRequest();
        request.open('POST', reqURL, false);
        request.setRequestHeader('Authorization', 'Basic ' + localStorage.getItem('basicAuthToken'));
        request.setRequestHeader('Content-Type', 'application/json');
        request.send(JSON.stringify({
            author_id: authorId,
            title: title,
            description: description,
            pub_date: pubDate,
            type: announcementType,
        }));
        console.log(request.response);
    }
</script>
</html>